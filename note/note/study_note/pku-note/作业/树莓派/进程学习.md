## è¿›ç¨‹äº§ç”Ÿå’Œæ”¶å°¸
### ä»‹ç»
[47. 01.è¿›ç¨‹-è¿›ç¨‹æ¦‚å¿µå’Œfork_å“”å“©å“”å“©_bilibili](https://www.bilibili.com/video/BV1wd4y137fd/?p=43&spm_id_from=333.1007.top_right_bar_window_history.content.click&vd_source=f8bf73f9a2b495eaf6f8446fa6016bc7)

Start
[02:10](https://www.bilibili.com/video/BV1wd4y137fd/?p=43&spm_id_from=333.1007.top_right_bar_window_history.content.click&vd_source=f8bf73f9a2b495eaf6f8446fa6016bc7#t=130.207791)

![](https://raw.githubusercontent.com/acdefg/cdn/main/obsidian/202211161025627.png)
![](https://raw.githubusercontent.com/acdefg/cdn/main/obsidian/202211161026452.png)


### Pid æ ‡è¯†ç¬¦
ç±»å‹ pid_t 16 singned int, more than 30000
#### ps
man ps
ps -axf 
ps -axm
ps ax -L
#### è¿›ç¨‹å·
- è¿›ç¨‹å·æ˜¯é¡ºæ¬¡å‘ä¸‹ä½¿ç”¨çš„
- getpid() å½“å‰è¿›ç¨‹
- getppid() çˆ¶è¿›ç¨‹
### è¿›ç¨‹äº§ç”Ÿ
#### fork()
æ‰§è¡Œä¸€æ¬¡è¿”å›ä¸¤æ¬¡
é€šè¿‡å¤åˆ¶çˆ¶è¿›ç¨‹ï¼Œåˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œä¸€æ¨¡ä¸€æ ·ï¼Œè¿æ‰§è¡Œçš„ä½ç½®éƒ½ä¸€æ ·
![200](https://raw.githubusercontent.com/acdefg/cdn/main/obsidian/202211161041569.png)
çˆ¶å­è¿›ç¨‹çš„åŒºåˆ«ï¼š
1. è¿”å›å€¼ä¸åŒ
2. pidï¼Œppid ä¸åŒ
3. å‘³è§‰ä¿¡å·å’Œæ–‡ä»¶é”ä¸ç»§æ‰¿
4. èµ„æºåˆ©ç”¨é‡æ¸… 0
![500](https://raw.githubusercontent.com/acdefg/cdn/main/obsidian/202211161118328.png)

##### init()
è¿›ç¨‹äº§ç”Ÿï¼Œä½¿è¿›ç¨‹å˜æˆåº“å®ˆåœ¨åå°ï¼Œåˆ†èº«
init è¿›ç¨‹æ˜¯æ‰€æœ‰è¿›ç¨‹çš„ç¥–å…ˆè¿›ç¨‹ï¼Œæ˜¯ 1 å·è¿›ç¨‹

#### fork()è¿ç”¨
[Fetching Title#rarb](https://www.bilibili.com/video/BV1wd4y137fd?p=44&vd_source=f8bf73f9a2b495eaf6f8446fa6016bc7)
![200](https://raw.githubusercontent.com/acdefg/cdn/main/obsidian/202211161600830.png)
![400](https://raw.githubusercontent.com/acdefg/cdn/main/obsidian/202211161525949.png)
begin æ—¶çˆ¶è¿›ç¨‹ï¼Œfork() äº§ç”Ÿå­è¿›ç¨‹
![400](https://raw.githubusercontent.com/acdefg/cdn/main/obsidian/202211161526442.png)
æ‰“å°ç»“æœï¼šè¿™é‡Œå› ä¸ºç¨‹åºé”™è¯¯ä¼šå‡ºç° shell é‚£ä¸ª@å‘½ä»¤å…ˆæ‰“å°å‡ºæ¥äº†
![400](https://raw.githubusercontent.com/acdefg/cdn/main/obsidian/202211161528938.png)

ç¬¬ä¸€ç‚¹ï¼š

```c
#include <stdio.h>
#include <stdlib.h>
#include <sys/types.h>
#include <unistd.h>

int main()
{
    printf("%d start !\n",getpid());
    fflush(NULL);//è®°å¾—åˆ·æ–° å¦åˆ™beginæ”¾åˆ°ç¼“å†²åŒº çˆ¶å­è¿›ç¨‹çš„ç¼“å†²åŒºé‡Œå„æœ‰ä¸€å¥begin

    pid_t pid = fork();

    if (pid == 0){
        printf("child %d\n",getpid());
    }else{
        printf("parent %d\n",getpid());
    }
    getchar();
    printf("pid %d end\n",getpid());
    return 0;
}

```

å¯èƒ½æ˜¯çˆ¶è¿›ç¨‹å…ˆæ‰“åº”ï¼Œå¯èƒ½æ˜¯å­è¿›ç¨‹ï¼Œè¿™é‡Œæ˜¯å­è¿›ç¨‹ï¼Œ**è¿™ä¸ªé¡ºåºæ˜¯ç”±è°ƒåº¦å™¨çš„è°ƒåº¦ç­–ç•¥å†³å®šçš„ã€‚**
![400](https://raw.githubusercontent.com/acdefg/cdn/main/obsidian/202211161530962.png)
è®©çˆ¶è¿›ç¨‹å‘†ä¸€ä¼šï¼Œä½†æ˜¯å¹³å¸¸ä¸å»ºè®®ç”¨ sleepï¼Œå¯ä»¥çœ‹åˆ°å­è¿›ç¨‹å…ˆè¿è¡Œ
![400](https://raw.githubusercontent.com/acdefg/cdn/main/obsidian/202211161531103.png)

ç¬¬äºŒç‚¹ï¼š
å…ˆ getchar() æŒ‚èµ·è¿›ç¨‹ï¼Œç”¨ ps axfå‘½ä»¤çœ‹åˆ°çˆ¶å­è¿›ç¨‹è°ƒåº¦å…³ç³»ï¼š
[11:50](https://www.bilibili.com/video/BV1wd4y137fd?p=44&vd_source=f8bf73f9a2b495eaf6f8446fa6016bc7#t=710.430759)
çˆ¶å­è¿›ç¨‹é˜¶æ¢¯å…³ç³»ï¼š
![300](https://raw.githubusercontent.com/acdefg/cdn/main/obsidian/202211161534579.png)
é¡¶æ ¼å†™çš„è¿›ç¨‹ï¼Œå®ƒçš„çˆ¶è¿›ç¨‹æ˜¯ init è¿›ç¨‹ã€‚
![](https://raw.githubusercontent.com/acdefg/cdn/main/obsidian/202211210019121.png)

ç¬¬ä¸‰ç‚¹ï¼š
[14:50](https://www.bilibili.com/video/BV1wd4y137fd?p=44&vd_source=f8bf73f9a2b495eaf6f8446fa6016bc7#t=890.267556)
é‡æ–°å®šå‘åˆ°/tmp/out é‡Œï¼Œæœ‰ä¸¤ä¸ª beginï¼Œè¡Œç¼“å†²æ¨¡å¼å’Œå…¨ç¼“å†²æ¨¡å¼
fflush(NULL); åˆ·æ–°æ‰€æœ‰æµï¼Œåœ¨ fork()å‰ä¸€å®šè¦åŠ 
![300](https://raw.githubusercontent.com/acdefg/cdn/main/obsidian/202211161547618.png)

[49. 03.è¿›ç¨‹-forkå®ä¾‹2_å“”å“©å“”å“©_bilibili](https://www.bilibili.com/video/BV1wd4y137fd?p=45&vd_source=f8bf73f9a2b495eaf6f8446fa6016bc7)
æ¡†æ¶
![200](https://raw.githubusercontent.com/acdefg/cdn/main/obsidian/202211161601223.png)
è´¨æ•° 3000000-30000200
![200](https://raw.githubusercontent.com/acdefg/cdn/main/obsidian/202211161604508.png)
ç¬¬ä¸€ä¸ªæ‰“å°è¡Œæ•°ï¼Œç¬¬äºŒä¸ªæ‰“å°æ—¶é—´
![300](https://raw.githubusercontent.com/acdefg/cdn/main/obsidian/202211161605543.png)
ä»…æ‰“å°æ—¶é—´ï¼Œå…¶ä»–è¾“å‡ºé‡å®šå‘åˆ°ç©ºè®¾å¤‡ä¸Š
![300](https://raw.githubusercontent.com/acdefg/cdn/main/obsidian/202211161605932.png)

ç°åœ¨è®© 201 ä¸ªè¿›ç¨‹æ¥æ‰§è¡Œä»¥ä¸Šç¨‹åº
![200](https://raw.githubusercontent.com/acdefg/cdn/main/obsidian/202211161610583.png)
![200](https://raw.githubusercontent.com/acdefg/cdn/main/obsidian/202211161613880.png)
ä½†æ˜¯æ—¶é—´çš„å‡å°‘å’Œå¤„ç†å™¨æ ¸æ•°æœ‰å…³ï¼Œæ ¸æ˜¯æ‰§è¡Œå·¥å…·ï¼Œç›¸å½“äºæœ‰ 201 ä¸ªäººæ’é˜Ÿä½¿ç”¨å·¥å…·ã€‚

```c
#include <stdio.h>
#include <stdlib.h>
#include <sys/types.h>
#include <unistd.h>

#define LEFT 2
#define RIGHT 200

int main()
{
    pid_t pid = 0;
    int i,j,mark;

    for (i = LEFT;i <= RIGHT;i++){
        pid = fork();
        if (pid == 0){
            mark = 1;
            for (j = 2;j < i/2;j++){
                if (i%j == 0){
                    mark = 0;
                    break;
                }
            }
            if (mark) {
                printf("%d is a primer\n",i);
            }
            exit(0);
        }
    }
    getchar();

    exit(0);
}

```
![](https://raw.githubusercontent.com/acdefg/cdn/main/obsidian/202211210155213.png)
![](https://raw.githubusercontent.com/acdefg/cdn/main/obsidian/202211210156167.png)
![](https://raw.githubusercontent.com/acdefg/cdn/main/obsidian/202211210156651.png)

![](https://raw.githubusercontent.com/acdefg/cdn/main/obsidian/202211210156157.png)

[50. 04.è¿›ç¨‹-initè¿›ç¨‹å’Œvfork_å“”å“©å“”å“©_bilibili](https://www.bilibili.com/video/BV1wd4y137fd?p=46&vd_source=f8bf73f9a2b495eaf6f8446fa6016bc7)
ä¸æ¸…æ¥šç¨‹åºçŠ¶æ€ï¼Œå¯ä»¥ `man ps `ï¼Œé‡Œé¢æœ‰è¯´
è°æ‰“å¼€è°å…³é—­ï¼Œè°ç”³è¯·è°é‡Šæ”¾
zombi çŠ¶æ€ä¸å ç”¨ç³»ç»Ÿå…¶ä»–èµ„æºï¼Œä½†æ˜¯å ç”¨äº† pid å·ï¼Œæ‰€ä»¥è¦æ”¶å°¸
ä¸€å®šè¦ exit()
### vfork()
vfork()å’Œ fork()çš„åŒºåˆ«ï¼š
[16:05](https://www.bilibili.com/video/BV1wd4y137fd?p=46&vd_source=f8bf73f9a2b495eaf6f8446fa6016bc7#t=965.638527)
fork çš„å†™æ—¶æ‹·è´
[19:21](https://www.bilibili.com/video/BV1wd4y137fd?p=46&vd_source=f8bf73f9a2b495eaf6f8446fa6016bc7#t=1161.314171)

```c

#include <stdio.h>
#include <unistd.h>
#include <sys/types.h>

int main()
{
	//åˆ›å»ºå­è¿›ç¨‹
	pid_t pid = vfork();
	
	if(pid<0)
	{
		perror("creat failed");
		return -1;
	}

	else if(pid == 0)
	{
		printf("i am child\n");
		sleep(2);
		//é€€å‡ºå­è¿›ç¨‹
		_exit(0);
	}

	else if(pid >0)
	{
		printf("i am parent\n");
	}
	return 0;
}

```
[å¤šè¿›ç¨‹ä¹‹åˆ›å»ºå­è¿›ç¨‹fork,vforkå‡½æ•°_è°¢æ°¸å¥‡1çš„åšå®¢-CSDNåšå®¢](https://blog.csdn.net/takashi77/article/details/108053655)
![](https://raw.githubusercontent.com/acdefg/cdn/main/obsidian/202211210150869.png)

### wait()
æ”¶å°¸ç¯èŠ‚ï¼Œä¸ºä»€ä¹ˆå‘½ä»¤è¡Œå…ˆå¼¹å‡ºï¼š
[51. 05.è¿›ç¨‹-waitå’Œwaitpid_å“”å“©å“”å“©_bilibili](https://www.bilibili.com/video/BV1wd4y137fd?p=47&vd_source=f8bf73f9a2b495eaf6f8446fa6016bc7)
#### wait() 
æˆåŠŸï¼šè¿”å›ç»ˆæ­¢çš„å­è¿›ç¨‹çš„ pid
å¤±è´¥ï¼š-1
äº”æ¡æ­£å¸¸ç»ˆæ­¢ï¼Œä¸‰æ¡å¼‚å¸¸ç»ˆæ­¢
![300](https://raw.githubusercontent.com/acdefg/cdn/main/obsidian/202211161724999.png)

#### waitpid()
![](https://raw.githubusercontent.com/acdefg/cdn/main/obsidian/202211161734144.png)

#### ä¸Šä¸ªä¾‹ç¨‹çš„æ”¶å°¸
åŠ ä¸¤ä¸ªå¤´æ–‡ä»¶
![](https://raw.githubusercontent.com/acdefg/cdn/main/obsidian/202211161737198.png)
å¯çœ‹çŠ¶æ€ï¼Œå¯ä¸çœ‹
![](https://raw.githubusercontent.com/acdefg/cdn/main/obsidian/202211161736757.png)

waitid()
wait3()   wait4() freebs é‡Œçš„

### æœªåšç¬”è®°

![](https://raw.githubusercontent.com/acdefg/cdn/main/obsidian/202211180942807.png)
![](https://raw.githubusercontent.com/acdefg/cdn/main/obsidian/202211210125843.png)
![](https://raw.githubusercontent.com/acdefg/cdn/main/obsidian/202211210128116.png)

```shell
#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <glob.h>
#include <string.h>
#include <sys/types.h>
#include <sys/wait.h>

#define DELIMS " \t\n"  //åˆ†éš”ç¬¦
			//
struct cmd_st{
	glob_t globres;
};

static void prompt(void)
{
	printf("myshell-0.1 $ ");
}

static  void parse(char *line, struct cmd_st *res){
	char *tok;
	//strtokæ ¹æ®åˆ†éš”ç¬¦æ‰“æ•£,éœ€è¦å¾ªç¯
	//strsep

	int i = 0;
	while(1){
	tok = strsep(&line,DELIMS);
	if(tok == NULL)
		break;  //ç©ºä¸²çš„è¯
	if(tok[0] == '\0')
		continue;

	glob(tok, GLOB_NOCHECK|GLOB_APPEND*i, NULL, &res->globres);
	i = 1;
	}
}

int main()
{
	pid_t pid;
	char *linebuf = NULL;
	size_t linebuf_size = 0;
	struct cmd_st cmd; 
	while(1)
	{
		prompt();  //æ‰“å°æç¤ºç¬¦
		//fir_p:ä¸€çº§æŒ‡é’ˆåœ°å€ï¼ˆäºŒçº§ï¼‰sec_p:å¤§å° stdinï¼šæ ‡å‡†è¾“å…¥
		if(getline(&linebuf, &linebuf_size,stdin)<0) //è·å–ç»ˆç«¯è¾“å…¥
			break;
		parse(linebuf, &cmd); //è§£æå†…éƒ¨å‘½ä»¤è¿˜æ˜¯å¤–éƒ¨å‘½ä»¤

		if(0){    //å†…éƒ¨å‘½ä»¤
		
		}
		else{
			pid = fork();
			if(pid < 0){
				perror("fork()");
				exit(1);
			}
			if(pid == 0){
				execvp(cmd.globres.gl_pathv[0], cmd.globres.gl_pathv);
				perror("execvp()");
				exit(1);
			}
			else{
				wait(NULL);
			}
		}
	}

	exit(0);
}
```


## è¿›ç¨‹é€šä¿¡
[01.å¹¶å‘-å¼‚æ­¥äº‹ä»¶å¤„ç†çš„ä¸¤ç§æ–¹æ³•_å“”å“©å“”å“©_bilibili](https://www.bilibili.com/video/BV1yJ411S7r6/?p=62&vd_source=f8bf73f9a2b495eaf6f8446fa6016bc7)
å¹¶å‘æœ‰ä¸¤ç§æ–¹å¼ï¼šä¿¡å·å’Œå¤šçº¿ç¨‹
ä¿¡å·ï¼šä¿¡å·æ˜¯è½¯ä»¶ä¸­æ–­
åŒæ­¥ï¼šæ¸…æ¥šæ¯ä¸ªæ—¶åˆ»ä¼šå‡ºç°çš„é—®é¢˜
å¼‚æ­¥ï¼šåœ¨è¿è¡Œçš„æ—¶å€™åŒæ—¶å“åº”æœªçŸ¥æ“ä½œï¼Œä¿„ç½—æ–¯æ–¹å—
	å¼‚æ­¥äº‹ä»¶çš„å¤„ç†ï¼šæŸ¥è¯¢æ³•ï¼Œé€šçŸ¥æ³•
	é¢‘ç‡ç¨€ç–ç”¨é€šçŸ¥æ³•ï¼Œé¢‘ç‡å¯†é›†ç”¨æŸ¥è¯¢æ³•
	
![](https://raw.githubusercontent.com/acdefg/cdn/main/obsidian/202211181001738.png)
![](https://raw.githubusercontent.com/acdefg/cdn/main/obsidian/202211181002370.png)

10 ä¹‹å‰æ˜¯æ ‡å‡†ä¿¡å·ï¼Œ9 é‡Œé¢å¯ä»¥æ›¿æ¢å‰é¢çš„éƒ¨åˆ†ä¿¡å·
### ä¿¡å·çš„æ¦‚å¿µ
[02.å¹¶å‘-ä¿¡å·çš„åŸºæœ¬æ¦‚å¿µ_å“”å“©å“”å“©_bilibili](https://www.bilibili.com/video/BV1yJ411S7r6?p=63&vd_source=f8bf73f9a2b495eaf6f8446fa6016bc7)
ä¿¡å·çš„å“åº”ä¾èµ–äºä¸­æ–­
`kill -l` æŸ¥çœ‹æ‰€æœ‰ä¿¡å·ï¼Œ34-64 å®æ—¶ä¿¡å·ï¼Œ1-33 æ ‡å‡†ä¿¡å·

```shell
#include "stdio.h"
#include "sys/types.h"
#include "signal.h"
#include "stdio.h"
#include "stdlib.h"
void myfun(int signum)
{
  int i;
  i=0;
  while(i <5)
  {
	printf("receive signum=%d,i=%d\n",signum,i);
	sleep(1);
	i++;
  }
  return;
}
void myfun1(int signum)
{
  printf("receive signum=%d\n",signum);
  wait(NULL);//ä¸å›æ”¶å­è¿›ç¨‹å°†å˜ä¸ºåƒµå°¸è¿›ç¨‹ï¼ˆZï¼‰
  return ;
}
 
int main()
{
  pid_t pid;
  pid=fork();
  if(pid > 0 )
  {
	int i;
	i=0;
	signal(10,myfun);
	signal(17,myfun1);
	while(1)
	{
     printf("parent process things,i=%d\n",i);
	 sleep(1);
	 i++;
	}
  }
  if(pid ==  0)
  {
	sleep(10);
	kill(getppid(),10);
	sleep(10);
	exit(0);//kill(getppid(),17)
  }
  return 0;
}
```

![200](https://raw.githubusercontent.com/acdefg/cdn/main/obsidian/202211210222914.png)
![](https://raw.githubusercontent.com/acdefg/cdn/main/obsidian/202211210222914.png)
![](https://raw.githubusercontent.com/acdefg/cdn/main/obsidian/202211210232462.png)
![](https://raw.githubusercontent.com/acdefg/cdn/main/obsidian/202211210232537.png)
![](https://raw.githubusercontent.com/acdefg/cdn/main/obsidian/202211210232788.png)

### book
unix ç¯å¢ƒé«˜çº§ç¼–ç¨‹

è¿™æ€ä¹ˆå†™å‡ºæ¥çš„é˜¿ï¼Œ5555555
![](https://raw.githubusercontent.com/acdefg/cdn/main/obsidian/202211182204505.png)

# ä½œä¸šè¦æ±‚
å®éªŒå†…å®¹  
1. ç¼–å†™fork()ï¼Œvfork()åˆ›å»ºå¤šè¿›ç¨‹ç¨‹åºï¼Œè°ƒç”¨exec()ï¼Œwait()  
å‡½æ•°ï¼Œé€šè¿‡è¾“å‡ºç»“æœè§‚å¯Ÿè¿›ç¨‹çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œç†è§£å‡½æ•°åœ¨  
åˆ›å»ºè¿›ç¨‹ä¸­çš„ä½œç”¨ã€‚  
2. ç¼–å†™fork()å¤šè¿›ç¨‹ç¨‹åºï¼Œè¿›ç¨‹é—´æ¨¡æ‹Ÿä¿¡å·é€šä¿¡ï¼ŒåŒ…æ‹¬ä¿¡å·  
å‘é€ã€æ•æ‰ä¸å¤„ç†ã€‚  
3. ç¼–å†™fork()å¤šè¿›ç¨‹ç¨‹åºï¼Œè¿›ç¨‹é—´å®ç°æœ‰åç®¡é“å’Œæ— åç®¡é“  
é€šä¿¡ã€‚å…·ä½“è¦æ±‚å¦‚ä¸‹ï¼š  
âš« ç¼–å†™1ä¸ªæœåŠ¡å™¨ç¨‹åºserver.cå’Œ2ä¸ªå®¢æˆ·ç«¯ç¨‹åºclient1.cï¼Œclient2.cï¼Œ  
æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¹‹é—´é‡‡ç”¨æœ‰å(FIFO)ç®¡é“é€šä¿¡ï¼›  
âš« æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯å†å„è‡ªåˆ›å»ºè‡ªå·±çš„å­è¿›ç¨‹ï¼Œå­è¿›ç¨‹è´Ÿè´£è¾“å‡ºæœåŠ¡  
å™¨æˆ–å®¢æˆ·ç«¯æ¥æ”¶åˆ°çš„ä¿¡æ¯ï¼Œçˆ¶å­è¿›ç¨‹é—´é‡‡ç”¨æ— åç®¡é“é€šä¿¡ã€‚

# reference
[Linuxè¿›ç¨‹é—´é€šä¿¡(å››)---ä¿¡å·é€šä¿¡ä¹‹ä¿¡å·å‘é€æ•æ‰kill()ã€raise()ã€alarm()ã€pause()åŠå…¶åŸºç¡€å®éªŒ_ç–é›¶å¤§å£®çš„åšå®¢-CSDNåšå®¢](https://blog.csdn.net/mybelief321/article/details/9078193) å†™çš„å¥½ğŸ˜
[06.ä¿¡å·-killã€raiseã€pause_å“”å“©å“”å“©_bilibili](https://www.bilibili.com/video/BV1yJ411S7r6?p=67&vd_source=f8bf73f9a2b495eaf6f8446fa6016bc7) æ—¶é—´æœ‰é™ï¼Œä¸ç„¶æˆ‘ä¹Ÿæƒ³çœ‹å§å§è®²è¯¾
[è¿›ç¨‹é€šä¿¡ï¼ˆä¸€ï¼‰æ— åç®¡é“å’Œæœ‰åç®¡é“ - è…¾è®¯äº‘å¼€å‘è€…ç¤¾åŒº-è…¾è®¯äº‘](https://cloud.tencent.com/developer/article/1946537) è¿™ç¯‡å¥½è±¡å°±å¤Ÿäº†ï¼Œå†æµ…æµ…äº†è§£ä¸‹åŸç†
[LinuxC/Process.md at main Â· impact-eintr/LinuxC Â· GitHub](https://github.com/impact-eintr/LinuxC/blob/main/APUE/Process.md)  ä»£ç åˆè¾‘
