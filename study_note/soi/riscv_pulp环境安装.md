起因 pulpion 环境要求：
大问题在于 riscv 交叉编译工具链的安装，xs 后来发现 modelsim 才难搞
它要 riscv32-unknown-elf-gcc，应该重点在 32 位，newlib 版本

> [!attention] 注意
> 要切换到 root 路径下，打开下载好的 tool chain 文件夹
> 记得在 zsh/bash 中添加路径，[[在 zsh 中添加路径]]
> 安装错了可以先 `make clean` 再 make

## pulpion environment requirement
![500](https://raw.githubusercontent.com/acdefg/cdn/main/obsidian/202211181431287.png)
[[ubuntu安装modelsim]]


## reference link
[编译riscv32-unknown-elf-gcc_牧羊女说的博客-CSDN博客](https://blog.csdn.net/deliapu/article/details/120708442) 比较详细
[RISC-V GNU工具链的编译与安装 - 知乎](https://zhuanlan.zhihu.com/p/364638851) 有指令的解析
[riscv各种版本gcc工具链编译与安装_weiqi7777的博客-CSDN博客](https://blog.csdn.net/weiqi7777/article/details/88045720) riscv 的各种工具链
[PULPino 在 Modelsim 下的软件模拟 - 知乎](https://zhuanlan.zhihu.com/p/470281404) 看到的第一个模拟，modelsim，参考意义不大
[pulpino[1] nuttx：bring up · 大专栏](https://www.dazhuanlan.com/cnrootkit/topics/1415719) pulpion nuttx 内核移植
[安装一个可用的Linux版本Modelsim](https://junningwu.haawking.com/tech/2019/12/11/%E5%AE%89%E8%A3%85%E4%B8%80%E4%B8%AA%E5%8F%AF%E7%94%A8%E7%9A%84Linux%E7%89%88%E6%9C%ACModelsim/) modelsim 仿真 pulpion
[Running Modelsim on a 64-bit Ubuntu - Github personal blog](https://pcotret.github.io/modelsim-ubuntu/) 用到 freetype 不懂但是留着

[Issues · pulp-platform/pulpino · GitHub](https://github.com/pulp-platform/pulpino/issues) 😒鉴于我老点它，所以存一下
## log
### pulipion

```shell
git clone https://github.com/pulp-platform/pulpino.git
cd pulpion
./update-ips.py
```
因为不在开头就跑 update 出错无数次

建议再跑一个，虽然很多博客和教程中都没提，但我遇到了问题
```shell
./generate-scripts.py
```

### tool chain

下载 tool chain respository
```shell
git clone --recursive https://github.com/pulp-platform/pulp-riscv-gnu-toolchain
```
在使用官方库的时候用 `--recursive` 选项失败，这里可以成功

安装环境 ubuntu：
```shell
$ sudo apt-get install autoconf automake autotools-dev curl libmpc-dev libmpfr-dev libgmp-dev gawk build-essential bison flex texinfo gperf libtool patchutils bc zlib1g-dev
```

安装，这一步要先切 root 用户
```shell
./configure --prefix=/opt/riscv --with-arch=rv32imc --with-cmodel=medlow --enable-multilib
make newlib -j4
```
这一步大部分选项算是一种尝试，直接使用下面 newlib 的指令安装的是 64 位，make 的选项可以参考 [RISC-V GNU工具链的编译与安装 - 知乎](https://zhuanlan.zhihu.com/p/364638851) 这里

> [!attention] 注意
> 要切换到 root 路径下，打开下载好的 tool chain 文件夹
> 记得在 zsh/bash 中添加路径，[[在 zsh 中添加路径]]
> 安装错了可以先 `make clean` 再 make

#### 一些工具链：
[GitHub - acdefg/pulp-riscv-gnu-toolchain](https://github.com/acdefg/pulp-riscv-gnu-toolchain) pulp
[GitHub - acdefg/riscv-gnu-toolchain: GNU toolchain for RISC-V, including GCC](https://github.com/acdefg/riscv-gnu-toolchain) riscv
[GitHub - acdefg/ri5cy_gnu_toolchain](https://github.com/acdefg/ri5cy_gnu_toolchain) ri5cy
个人感觉 pulp tool chain 和 riscv 的应该是一样的，前几次安装 ri5cy 老是失败有可能是没有开 root 权限，直接换了 pulp tool chain
![300](https://raw.githubusercontent.com/acdefg/cdn/main/obsidian/202211181412510.png) ![300](https://raw.githubusercontent.com/acdefg/cdn/main/obsidian/202211181419145.png)

### pulp 编译篇
#### part 1
在 pulpion 源码文件夹下面，去 SW 文件夹下面 `mkdir build`，然后在把 SW 下的这个复制到 build 里面，虽然会报错，但是还是运行一下 `cmake_configure.riscv.gcc.sh` ，其它几个对应不同的 riscv

```shell
./cmake_configure.riscv.gcc.sh
```
然后新建两个文件，并且 `chmod u+x *.sh` ，以防忘记请把*号替换成文件名
fix_m32.sh

```shell
#!/bin/bash

#Find and replace all occurrances of '-m32' and fix rest of line.

for file in $(find); do
    if [[ -f $file ]]; then
        [[ $(cat $file | grep m32) ]]
        if [[ $? == 0 ]]; then
            echo writing...
            echo $file
           sed 's/\-m32//g' $file > tmp && mv tmp $file
       fi
    fi
done
```

fix_linker.sh

```shell
#!/bin/zsh

riscv32-unknown-elf-ld --verbose | head -n -1 | tail -n +7 | sed '168 a \ \ _fbss = .;' | sed '169 a \ \ . = .;' > /home/cici/code/qulp_test/pulpino/sw/build/CMakeFiles/CMakeTmp/riscv.ld
```
最后那个很长的路径要改掉

再修改 cmake***.sh 文件中的 `GCC_MARCH="RV32IMXpulpv2"`，把原来的这个标志换掉好嘛

先跑 fix_m32.sh，然后跑 fix_linker.sh，跑 cmake_configure.riscv.gcc.sh，和 fix_linker.sh 交替跑，直到成功

#### part 2
make helloworld 会失败，因为环境不适配建议都是更换

### 一些错误
1. /usr/bin/env: ‘python’: No such file or directory
没定位 python
2. Missing parentheses in call to 'print'. Did you mean print(...)?
python2，不能用 python3
这两个一起解决用：

```shell
sudo ln -s /usr/bin/python2 /usr/bin/python
```

当然先看看 python2 在哪，虽然一般就在/usr/bin 下面，没有 python2 就装一个，原来用 python3 定位的默认 python，直接 `sudo rm /usr/bin/python`，再定位就好了，反正就是很暴力，已经烦了
3. ImportError: No module named yaml
只能说不要再报错了，受够了，能不能一次把话说清楚
`sudo pip2 install pyyaml #python2` python2 这么装，别问我 python3 怎么装，自己去搜吧
4. 安装 modelsim 19.0 报错
![300](https://raw.githubusercontent.com/acdefg/cdn/main/obsidian/202211181745047.png)
5. [zsh: permission denied问题的解决办法_sido的博客-CSDN博客](https://blog.csdn.net/chnyifan/article/details/104705437)
6. /bin/sh :1 tcsh not found 之类的，手敲的，具体的忘记了
[Linux中tcsh/tcsh和bash的环境变量的配置以及切换shell版本_SOC罗三炮的博客-CSDN博客_linux tcsh](https://blog.csdn.net/luolaihua2018/article/details/124382529)

[libXft.so.2: cannot open shared object file: No such file or directory](https://www.linuxquestions.org/questions/linux-newbie-8/libxft-so-2-cannot-open-shared-object-file-no-such-file-or-directory-4175413269/)

[Questa 10.7 在 ubuntu20.04下安装成功了_杰之行的博客-CSDN博客](https://blog.csdn.net/haojie_duan/article/details/119248753#t5)

[Site Unreachable](https://blog.csdn.net/qq446293528/article/details/113895761)


```shell
sudo apt install tcsh
```
还安错了一次，安成了 tclsh，这些应该和 zsh 一样是一种 shell

## ideas
用 qemu 仿真试试，参考普通 riscv 的办法，难点在于没有程序可以测试
往 riscv 上移植一个系统内核

### log

```shell
writing...
./libs/bench_lib/CMakeFiles/bench.dir/flags.make
writing...
./libs/Arduino_lib/core_libs/CMakeFiles/Arduino_core.dir/flags.make
writing...
./libs/Arduino_lib/separate_libs/CMakeFiles/Arduino_separate.dir/flags.make
writing...
./libs/string_lib/CMakeFiles/string.dir/flags.make
writing...
./libs/sys_lib/CMakeFiles/sys.dir/flags.make
writing...
./apps/Arduino_tests/int_test/CMakeFiles/int_test.elf.dir/link.txt
writing...
./apps/Arduino_tests/int_test/CMakeFiles/int_test.elf.dir/flags.make
writing...
./apps/Arduino_tests/UART_test/CMakeFiles/UART_test.elf.dir/link.txt
writing...
./apps/Arduino_tests/UART_test/CMakeFiles/UART_test.elf.dir/flags.make
writing...
./apps/Arduino_tests/SPI_test/CMakeFiles/SPI_test.elf.dir/link.txt
writing...
./apps/Arduino_tests/SPI_test/CMakeFiles/SPI_test.elf.dir/flags.make
writing...
./apps/Arduino_tests/GPIO_test/CMakeFiles/GPIO_test.elf.dir/link.txt
writing...
./apps/Arduino_tests/GPIO_test/CMakeFiles/GPIO_test.elf.dir/flags.make
writing...
./apps/Arduino_tests/PulseIn_test/CMakeFiles/PulseIn_test.elf.dir/link.txt
writing...
./apps/Arduino_tests/PulseIn_test/CMakeFiles/PulseIn_test.elf.dir/flags.make
writing...
./apps/Arduino_tests/PWM_test/CMakeFiles/PWM_test.elf.dir/link.txt
writing...
./apps/Arduino_tests/PWM_test/CMakeFiles/PWM_test.elf.dir/flags.make
writing...
./apps/Arduino_tests/timer_test/CMakeFiles/timer_test.elf.dir/link.txt
writing...
./apps/Arduino_tests/timer_test/CMakeFiles/timer_test.elf.dir/flags.make
writing...
./apps/Arduino_tests/wire_test/CMakeFiles/wire_test.elf.dir/link.txt
writing...
./apps/Arduino_tests/wire_test/CMakeFiles/wire_test.elf.dir/flags.make
writing...
./apps/Arduino_tests/shift_test/CMakeFiles/shift_test.elf.dir/link.txt
writing...
./apps/Arduino_tests/shift_test/CMakeFiles/shift_test.elf.dir/flags.make
writing...
./apps/helloworld/CMakeFiles/helloworld.elf.dir/link.txt
writing...
./apps/helloworld/CMakeFiles/helloworld.elf.dir/flags.make
writing...
./apps/helloworld/CMakeFiles/helloworldcpp.elf.dir/link.txt
writing...
./apps/helloworld/CMakeFiles/helloworldcpp.elf.dir/flags.make
writing...
./apps/sequential_tests/matrixMul16_dotp/CMakeFiles/matrixMul16_dotp.elf.dir/link.txt
writing...
./apps/sequential_tests/matrixMul16_dotp/CMakeFiles/matrixMul16_dotp.elf.dir/flags.make
writing...
./apps/sequential_tests/non_separable_2d_filter/CMakeFiles/non_separable_2d_filter.elf.dir/link.txt
writing...
./apps/sequential_tests/non_separable_2d_filter/CMakeFiles/non_separable_2d_filter.elf.dir/flags.make
writing...
./apps/sequential_tests/convolution/CMakeFiles/convolution.elf.dir/link.txt
writing...
./apps/sequential_tests/convolution/CMakeFiles/convolution.elf.dir/flags.make
writing...
./apps/sequential_tests/bubblesort/CMakeFiles/bubblesort.elf.dir/link.txt
writing...
./apps/sequential_tests/bubblesort/CMakeFiles/bubblesort.elf.dir/flags.make
writing...
./apps/sequential_tests/matrixMul16/CMakeFiles/matrixMul16.elf.dir/link.txt
writing...
./apps/sequential_tests/matrixMul16/CMakeFiles/matrixMul16.elf.dir/flags.make
writing...
./apps/sequential_tests/dct/CMakeFiles/dct.elf.dir/link.txt
writing...
./apps/sequential_tests/dct/CMakeFiles/dct.elf.dir/flags.make
writing...
./apps/sequential_tests/matrixAdd/CMakeFiles/matrixAdd32.elf.dir/link.txt
writing...
./apps/sequential_tests/matrixAdd/CMakeFiles/matrixAdd32.elf.dir/flags.make
writing...
./apps/sequential_tests/matrixAdd/CMakeFiles/matrixAdd8.elf.dir/link.txt
writing...
./apps/sequential_tests/matrixAdd/CMakeFiles/matrixAdd8.elf.dir/flags.make
writing...
./apps/sequential_tests/matrixAdd/CMakeFiles/matrixAdd16.elf.dir/link.txt
writing...
./apps/sequential_tests/matrixAdd/CMakeFiles/matrixAdd16.elf.dir/flags.make
writing...
./apps/sequential_tests/stencil_vect/CMakeFiles/stencil_vect.elf.dir/link.txt
writing...
./apps/sequential_tests/stencil_vect/CMakeFiles/stencil_vect.elf.dir/flags.make
writing...
./apps/sequential_tests/fdct/CMakeFiles/fdct.elf.dir/link.txt
writing...
./apps/sequential_tests/fdct/CMakeFiles/fdct.elf.dir/flags.make
writing...
./apps/sequential_tests/crc32/CMakeFiles/crc32.elf.dir/link.txt
writing...
./apps/sequential_tests/crc32/CMakeFiles/crc32.elf.dir/flags.make
writing...
./apps/sequential_tests/pooling/CMakeFiles/pooling.elf.dir/link.txt
writing...
./apps/sequential_tests/pooling/CMakeFiles/pooling.elf.dir/flags.make
writing...
./apps/sequential_tests/matrixMul32/CMakeFiles/matrixMul32.elf.dir/link.txt
writing...
./apps/sequential_tests/matrixMul32/CMakeFiles/matrixMul32.elf.dir/flags.make
writing...
./apps/sequential_tests/cnn_layer/CMakeFiles/cnn_layer.elf.dir/link.txt
writing...
./apps/sequential_tests/cnn_layer/CMakeFiles/cnn_layer.elf.dir/flags.make
writing...
./apps/sequential_tests/matrixMul8/CMakeFiles/matrixMul8.elf.dir/link.txt
writing...
./apps/sequential_tests/matrixMul8/CMakeFiles/matrixMul8.elf.dir/flags.make
writing...
./apps/sequential_tests/sudokusolver/CMakeFiles/sudokusolver.elf.dir/link.txt
writing...
./apps/sequential_tests/sudokusolver/CMakeFiles/sudokusolver.elf.dir/flags.make
writing...
./apps/sequential_tests/matrixMul8_dotp/CMakeFiles/matrixMul8_dotp.elf.dir/link.txt
writing...
./apps/sequential_tests/matrixMul8_dotp/CMakeFiles/matrixMul8_dotp.elf.dir/flags.make
writing...
./apps/sequential_tests/fibonacci/CMakeFiles/fibonacci.elf.dir/link.txt
writing...
./apps/sequential_tests/fibonacci/CMakeFiles/fibonacci.elf.dir/flags.make
writing...
./apps/sequential_tests/stencil/CMakeFiles/stencil.elf.dir/link.txt
writing...
./apps/sequential_tests/stencil/CMakeFiles/stencil.elf.dir/flags.make
writing...
./apps/sequential_tests/motion_detection/CMakeFiles/motion_detection.elf.dir/link.txt
writing...
./apps/sequential_tests/motion_detection/CMakeFiles/motion_detection.elf.dir/flags.make
writing...
./apps/sequential_tests/towerofhanoi/CMakeFiles/towerofhanoi.elf.dir/link.txt
writing...
./apps/sequential_tests/towerofhanoi/CMakeFiles/towerofhanoi.elf.dir/flags.make
writing...
./apps/sequential_tests/bitDescriptor/CMakeFiles/bitDescriptor.elf.dir/link.txt
writing...
./apps/sequential_tests/bitDescriptor/CMakeFiles/bitDescriptor.elf.dir/flags.make
writing...
./apps/boot_code/CMakeFiles/boot_code.elf.dir/link.txt
writing...
./apps/boot_code/CMakeFiles/boot_code.elf.dir/flags.make
writing...
./apps/fpga/fpga_test/CMakeFiles/fpga_test.elf.dir/link.txt
writing...
./apps/fpga/fpga_test/CMakeFiles/fpga_test.elf.dir/flags.make
writing...
./apps/fpga/gpio_demo/CMakeFiles/gpio_demo.elf.dir/link.txt
writing...
./apps/fpga/gpio_demo/CMakeFiles/gpio_demo.elf.dir/flags.make
writing...
./apps/fpga/led_demo/CMakeFiles/led_demo.elf.dir/link.txt
writing...
./apps/fpga/led_demo/CMakeFiles/led_demo.elf.dir/flags.make
writing...
./apps/riscv_tests/testExceptions/CMakeFiles/testExceptions.elf.dir/link.txt
writing...
./apps/riscv_tests/testExceptions/CMakeFiles/testExceptions.elf.dir/flags.make
writing...
./apps/riscv_tests/testEvents/CMakeFiles/testEvents.elf.dir/link.txt
writing...
./apps/riscv_tests/testEvents/CMakeFiles/testEvents.elf.dir/flags.make
writing...
./apps/riscv_tests/testDebug/CMakeFiles/testDebug.elf.dir/link.txt
writing...
./apps/riscv_tests/testDebug/CMakeFiles/testDebug.elf.dir/flags.make
writing...
./apps/riscv_tests/testMisaligned/CMakeFiles/testMisaligned.elf.dir/link.txt
writing...
./apps/riscv_tests/testMisaligned/CMakeFiles/testMisaligned.elf.dir/flags.make
writing...
./apps/riscv_tests/testCSR/CMakeFiles/testCSR.elf.dir/link.txt
writing...
./apps/riscv_tests/testCSR/CMakeFiles/testCSR.elf.dir/flags.make
writing...
./apps/riscv_tests/testALU/CMakeFiles/testALU.elf.dir/link.txt
writing...
./apps/riscv_tests/testALU/CMakeFiles/testALU.elf.dir/flags.make
writing...
./apps/riscv_tests/official/CMakeFiles/rv_official.elf.dir/link.txt
writing...
./apps/riscv_tests/official/CMakeFiles/rv_official.elf.dir/flags.make
writing...
./apps/riscv_tests/testIRQ/CMakeFiles/testIRQ.elf.dir/link.txt
writing...
./apps/riscv_tests/testIRQ/CMakeFiles/testIRQ.elf.dir/flags.make
writing...
./apps/riscv_tests/basic/CMakeFiles/rv_basic.elf.dir/link.txt
writing...
./apps/riscv_tests/basic/CMakeFiles/rv_basic.elf.dir/flags.make
writing...
./apps/imperio_tests/testSPIMaster/CMakeFiles/testSPIMaster.elf.dir/link.txt
writing...
./apps/imperio_tests/testSPIMaster/CMakeFiles/testSPIMaster.elf.dir/flags.make
writing...
./apps/imperio_tests/testI2C/CMakeFiles/testI2C.elf.dir/link.txt
writing...
./apps/imperio_tests/testI2C/CMakeFiles/testI2C.elf.dir/flags.make
writing...
./apps/imperio_tests/testUART/CMakeFiles/testUART.elf.dir/link.txt
writing...
./apps/imperio_tests/testUART/CMakeFiles/testUART.elf.dir/flags.make
writing...
./apps/imperio_tests/testInterrupt/CMakeFiles/testInterrupt.elf.dir/link.txt
writing...
./apps/imperio_tests/testInterrupt/CMakeFiles/testInterrupt.elf.dir/flags.make
writing...
./apps/bench/ipm/CMakeFiles/perfbench.ipm.elf.dir/link.txt
writing...
./apps/bench/ipm/CMakeFiles/perfbench.ipm.elf.dir/flags.make
writing...
./apps/bench/fdctfst/CMakeFiles/perfbench.fdctfst.elf.dir/link.txt
writing...
./apps/bench/fdctfst/CMakeFiles/perfbench.fdctfst.elf.dir/flags.make
writing...
./apps/bench/sha/CMakeFiles/perfbench.sha.elf.dir/link.txt
writing...
./apps/bench/sha/CMakeFiles/perfbench.sha.elf.dir/flags.make
writing...
./apps/bench/aes_cbc/CMakeFiles/perfbench.aes_cbc.elf.dir/link.txt
writing...
./apps/bench/aes_cbc/CMakeFiles/perfbench.aes_cbc.elf.dir/flags.make
writing...
./apps/bench/fft/CMakeFiles/perfbench.fft.elf.dir/link.txt
writing...
./apps/bench/fft/CMakeFiles/perfbench.fft.elf.dir/flags.make
writing...
./apps/bench/keccak/CMakeFiles/perfbench.keccak.elf.dir/link.txt
writing...
./apps/bench/keccak/CMakeFiles/perfbench.keccak.elf.dir/flags.make
writing...
./apps/bench/conv2d/CMakeFiles/perfbench.conv2d.elf.dir/link.txt
writing...
./apps/bench/conv2d/CMakeFiles/perfbench.conv2d.elf.dir/flags.make
writing...
./apps/bench/CMakeFiles/perfbench.extras.dir/flags.make
writing...
./apps/bench/CMakeFiles/perfbench.core.dir/flags.make
writing...
./apps/bench/fir/CMakeFiles/perfbench.fir.elf.dir/link.txt
writing...
./apps/bench/fir/CMakeFiles/perfbench.fir.elf.dir/flags.make
writing...
./apps/freertos/CMakeFiles/freertos.elf.dir/link.txt
writing...
./apps/freertos/CMakeFiles/freertos.elf.dir/flags.make
writing...
./fix_m32.sh
writing...
./CMakeFiles/crt0_boot.dir/flags.make
writing...
./CMakeFiles/crt0.dir/flags.make

```
