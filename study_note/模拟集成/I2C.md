### 特点
- 只需要两条总线；
- 没有严格的波特率要求，例如使用RS232，主设备生成总线时钟；
- 所有组件之间都存在简单的主/从关系，连接到总线的每个设备均可通过唯一地址进行软件寻址；
- I2C 是真正的多主设备总线，可提供仲裁和冲突检测；
- 最大主设备数：无限制；
- 最大从机数：理论上是 127。
### 模式
1、标准模式：Standard Mode=100 Kbps
2、快速模式：Fast Mode=400 Kbps
3、高速模式：High speed mode=3.4 Mbps
4、超快速模式：Ultra fast mode=5 Mbps

### 硬件
I2C 协议仅需要 SDA 和 SCL 两个引脚。SDA 是串行数据线的缩写，而 SCL 是串行时钟线的缩写。这两条数据线需要接上拉电阻。
I2C 总线（SDA，SCL）内部都使用漏极开路驱动器（开漏驱动），因此 SDA 和 SCL 可以被拉低为低电平，但是不能被驱动为高电平，所以每条线上都要使用一个上拉电阻，默认情况下将其保持在高电平；
![](https://raw.githubusercontent.com/acdefg/cdn/main/obsidian/202308221559901.png)

[一文搞懂I2C通信 - 知乎](https://zhuanlan.zhihu.com/p/282949543) 一些关于上拉电阻的问题

### 数据传输协议

[I2C介绍及verilog实现（主机/从机可综合）\_i2c verilog代码\_swear蛋的博客-CSDN博客](https://blog.csdn.net/weixin_45863605/article/details/121730144) 这个写的很清楚

1. **总线拓扑**： I2C总线通常由两根线构成：
    - **SDA（Serial Data Line）**：用于传输数据，是双向的。
    - **SCL（Serial Clock Line）**：用于传输时钟信号，由主机控制。

1. **主从关系**： I2C 通信中存在主设备和从设备。主设备（通常是微控制器或处理器）控制总线并发起通信，而从设备则被动地响应主设备的请求。
    
2. **起始和停止条件**：
    - 通信始于主设备发送一个起始条件：S（Start）信号。
    - 通信结束于主设备发送一个停止条件：P（Stop）信号。
3. **地址传输**： 主设备通过发送从设备的唯一7位或10位地址来选择要与之通信的从设备。通常，第一位是从设备的地址，后续位用于指定读写操作。一个I2C事务可以包含多个从设备的地址，使主设备能够与多个设备通信。
    
4. **数据传输**： 数据传输是通过在时钟信号的边缘来同步传输的。数据线（SDA）上的每一位数据都在时钟线（SCL）的每个时钟脉冲上发生变化。通信可以是字节级的，主设备发送一个字节，然后从设备回应一个确认信号（ACK/NACK）。
    
5. **ACK/NACK**：
    - 当主设备发送一个字节后，接收设备（从设备）会回应ACK（应答）信号表示成功接收。
    - 如果接收设备无法接收或处理数据，它会回应 NACK（非应答）信号。

主设备通过将 SDA 线从高电平切换到低电平，再将 SCL 线从高电平切换到低电平，来向每个连接的从机发送启动条件。
**_开始位_*需要满足的条件：SCL 高电平时，SDA 由高变低；**_停止位_**需要满足的条件：SCL 为高电平时，SDA 由低变高
![](https://raw.githubusercontent.com/acdefg/cdn/main/obsidian/202308231351603.png)
![](https://raw.githubusercontent.com/acdefg/cdn/main/obsidian/202308231351304.png)
![](https://raw.githubusercontent.com/acdefg/cdn/main/obsidian/202308231352577.png)

![](https://raw.githubusercontent.com/acdefg/cdn/main/obsidian/202308231343957.png)
主设备向每个从机发送要与之通信的从机的 7 位或 10 位地址，以及相应的读/写位
![](https://raw.githubusercontent.com/acdefg/cdn/main/obsidian/202308231344319.png)

如果地址匹配，则从设备通过将 SDA 线拉低一位以表示返回一个 ACK 位。
如果来自主设备的地址与从机自身的地址不匹配，则从设备将 SDA 线拉高，表示返回一个 NACK 位。
![](https://raw.githubusercontent.com/acdefg/cdn/main/obsidian/202308231344974.png)
主设备发送或接收数据到从设备
**SDA 电平变化不能在 SCL 为高电平时进行，否则可能会被误认为成开始位或者停止位。因此 SDA 只能在 SCL 低电平时改变。**
在字节内，先传输 MSB
![](https://raw.githubusercontent.com/acdefg/cdn/main/obsidian/202308231345045.png)
10110100
![](https://raw.githubusercontent.com/acdefg/cdn/main/obsidian/202308231345939.png)

在传输完每个数据帧后，接收设备将另一个 ACK 位返回给发送方，以确认已成功接收到该帧
![](https://raw.githubusercontent.com/acdefg/cdn/main/obsidian/202308231346507.png)

为了停止数据传输，主设备将 SCL 切换为高电平，然后再将 SDA 切换为高电平

### 总结
I2C 协议采用主从结构。主控设备负责发起通信和控制整个通信过程

I2C 总线由两条线组成，一条是串行数据线（SDA），用于传输实际的数据信息；另一条是串行时钟线（SCL），用于同步通信的时钟信号12。这两条线通过上拉电阻接到电源，当总线空闲时，它们都保持高电平

**起始和停止信号**：起始信号是当 SCL 为高电平时，SDA 由高电平向低电平的跳变，表示一次数据传输的开始；停止信号是当 SCL 为高电平时，SDA 由低电平向高电平的跳变，表示数据传输的结束1

**数据传输格式**：数据以字节（8 位）为单位进行双向传输，主设备在发送完一个字节的数据后，会等待从设备的应答信号。应答信号是由从设备发出的，从设备通过将 SDA 线拉低来表示发出应答信号（ACK），表示通信成功；如果从设备不能再接收数据或数据传输出现错误，从设备会将 SDA 线保持高电平，发出非应答信号（NACK）

### **I2C 协议的数据传输过程**

1. **主设备发起通信**：主设备首先发送起始信号，表明要开始一次通信123。

2. **发送设备地址和读写位**：主设备接着发送要通信的从设备地址，地址通常是 7 位，然后跟一个读写位（0 表示写操作，1 表示读操作）123。

3. **从设备响应**：从设备接收到地址和读写位后，如果与自身地址匹配且准备好进行通信，就会将 SDA 线拉低作为应答信号；否则保持高电平12。

4. **数据传输（写操作）**：如果是写操作，主设备在每一个 SCL 时钟脉冲的下降沿将数据位放置在 SDA 线上，从设备在 SCL 时钟脉冲的上升沿读取数据位123。

5. **数据传输（读操作）**：如果是读操作，主设备发送起始信号和从设备地址后，再发送一个重新开始信号（Sr），然后发送要读取的寄存器地址。从设备接收到寄存器地址后，开始将数据通过 SDA 线发送给主设备，主设备在 SCL 时钟脉冲的上升沿读取数据位1。

6. **结束通信**：主设备发送或接收完一组数据后，会产生一个应答位（ACK 或 NACK），然后发送停止信号，结束本次通信123。  

### **I2C 协议的优点**

· **节省引脚资源**：只需要两根线（SDA 和 SCL）就可以实现多个设备之间的通信，大大节省了微控制器或芯片的引脚资源，这对于引脚数量有限的小型化、集成化设备非常重要2。

· **简单灵活**：其通信方式和协议相对简单，易于理解和实现，同时又具有足够的灵活性，可以满足不同设备之间各种数据传输需求，例如可以用于传输控制命令、状态信息、数据等2。

· **支持多设备连接**：可以在同一总线上连接多个从设备，每个从设备都有唯一的地址，主设备可以通过地址选择与之通信的从设备，方便构建多设备的分布式系统12。

· **速度较快**：一般情况下可以达到 100kb/s（标准模式）或 400kb/s（快速模式）的数据传输速率，能够满足许多常见电子设备的通信需求。在一些高速应用场景中，还有高速模式（3.4Mb/s）可供选择1。

### **I2C 协议的局限性**

· **通信距离有限**：由于使用的是电平信号传输，其传输距离受限于电平信号的衰减和噪声干扰，一般来说，传输距离不宜过长，通常在几米以内2。

· **网络拓扑结构限制**：需要主设备进行总线管理，因此网络拓扑结构受到一定限制，主设备数量和总线长度都有一定的要求2。

· **单主设备**：一般情况下，I2C 通信协议只支持单主设备和多从设备的连接方式，如果需要多主设备通信，则需要使用其他协议或采用特殊的扩展方式2
